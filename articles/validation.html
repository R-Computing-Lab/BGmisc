<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BGmisc">
<title>Validation tools for identifying and repairing errors in pedigrees • BGmisc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validation tools for identifying and repairing errors in pedigrees">
<meta property="og:description" content="BGmisc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BGmisc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/analyticrelatedness.html">Calculating and Inferring Relatedness Coefficients with BGmisc</a>
    <a class="dropdown-item" href="../articles/modelingrelatedness.html">Modeling and Relatedness</a>
    <a class="dropdown-item" href="../articles/network.html">Network tools for finding extended pedigrees and path tracing</a>
    <a class="dropdown-item" href="../articles/pedigree.html">Pedigree Simulation and Visualization with BGmisc</a>
    <a class="dropdown-item" href="../articles/validation.html">Validation tools for identifying and repairing errors in pedigrees</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/R-Computing-Lab/BGmisc/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Validation tools for identifying and repairing errors in pedigrees</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/R-Computing-Lab/BGmisc/blob/HEAD/vignettes/validation.Rmd" class="external-link"><code>vignettes/validation.Rmd</code></a></small>
      <div class="d-none name"><code>validation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>BGmisc</code> R package offers a comprehensive suite of
functions tailored for extended behavior genetics analysis, including
model identification, calculating relatedness, pedigree conversion, and
pedigree simulation. This vignette provides an overview of the
validation tools available in the package, designed to identify and
repair errors in pedigrees.</p>
<p>In an ideal world, you would have perfect pedigrees with no errors.
However, in the real world, pedigrees are often incomplete, contain
errors, or are missing data. The <code>BGmisc</code> package provides
tools to identify these errors, which is particularly useful for large
pedigrees where manual inspection is not feasible. While some errors in
the package can be automatically repaired, the vast majority require
manual inspection. It is often not possible to automatically repair
errors in pedigrees, as the correct solution may not be obvious, or may
depend on additional information that is not universally available.</p>
</div>
<div class="section level2">
<h2 id="identifying-and-repairing-errors-in-pedigrees">Identifying and Repairing Errors in Pedigrees<a class="anchor" aria-label="anchor" href="#identifying-and-repairing-errors-in-pedigrees"></a>
</h2>
<div class="section level3">
<h3 id="id-validation">ID Validation<a class="anchor" aria-label="anchor" href="#id-validation"></a>
</h3>
<p>One common issue in pedigree data is the presence of duplicate IDs.
There are two main types of ID duplication: within-row duplication and
across-row duplication. Within-row duplication occurs when an
individual’s parents’ IDs are incorrectly listed as their own ID.
Across-row duplication occurs when two or more individuals share the
same ID.</p>
<p>The <code>checkIDs</code> function in BGmisc helps identify by kinds
of duplicates. Here’s how to use it:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/R-Computing-Lab/BGmisc/" class="external-link">BGmisc</a></span><span class="op">)</span></span>
<span><span class="co"># Create a sample dataset</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ped2fam.html">ped2fam</a></span><span class="op">(</span><span class="va">potter</span>, famID <span class="op">=</span> <span class="st">"newFamID"</span>, personID <span class="op">=</span> <span class="st">"personID"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Call the checkIDs function</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkIDs.html">checkIDs</a></span><span class="op">(</span><span class="va">df</span>, repair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; $all_unique_ids</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_father</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_mother</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_duplicated_parents</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#&gt; $all_unique_ids</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_father</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_mother</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_duplicated_parents</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>In this example, the <code>checkIDs</code> function returns a list
with several elements. The <code>all_unique_ids</code> element indicates
whether all IDs in the dataset are unique. The
<code>total_non_unique_ids</code> element indicates the total number of
non-unique IDs. The <code>total_own_father</code> and
<code>total_own_mother</code> elements indicate the total number of
individuals whose father’s and mother’s IDs match their own ID,
respectively. The <code>total_duplicated_parents</code> element
indicates the total number of individuals with duplicated parent IDs.
The <code>total_within_row_duplicates</code> element indicates the total
number of within-row duplicates. The <code>within_row_duplicates</code>
element indicates whether there are any within-row duplicates in the
dataset. As the output shows, there are no duplicates in the sample
dataset.</p>
<div class="section level4">
<h4 id="between-person-duplicates">Between-Person Duplicates<a class="anchor" aria-label="anchor" href="#between-person-duplicates"></a>
</h4>
<p>Let us now consider a scenario where there are between-person
duplicates in the dataset. The <code>checkIDs</code> function can
identify these duplicates and, if the <code>repair</code> argument is
set to <code>TRUE</code>, attempt to repair them. In the example below,
we have created two between-person duplicates. First, we have
overwritten the <code>personID</code> of one person with their sibling’s
ID. Second, we have added a copy of Dudley Dursley to the dataset.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a sample dataset with duplicates</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ped2fam.html">ped2fam</a></span><span class="op">(</span><span class="va">potter</span>, famID <span class="op">=</span> <span class="st">"newFamID"</span>, personID <span class="op">=</span> <span class="st">"personID"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sibling overwrite</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">personID</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Vernon Dursley"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">personID</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Marjorie Dursley"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Add a copy of Dudley Dursley</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Dudley Dursley"</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s call the <code>sumarizeFamilies</code> function to see
what the dataset looks like.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.5</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.5.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/summarizeFamilies.html">summarizeFamilies</a></span><span class="op">(</span><span class="va">df</span>, famID <span class="op">=</span> <span class="st">"newFamID"</span>, personID <span class="op">=</span> <span class="st">"personID"</span><span class="op">)</span><span class="op">$</span><span class="va">family_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1</span></span>
<span><span class="co">#&gt; Columns: 17</span></span>
<span><span class="co">#&gt; $ newFamID        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1</span></span>
<span><span class="co">#&gt; $ count           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 37</span></span>
<span><span class="co">#&gt; $ gen_mean        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.756757</span></span>
<span><span class="co">#&gt; $ gen_median      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2</span></span>
<span><span class="co">#&gt; $ gen_min         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0</span></span>
<span><span class="co">#&gt; $ gen_max         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3</span></span>
<span><span class="co">#&gt; $ gen_sd          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.038305</span></span>
<span><span class="co">#&gt; $ spouseID_mean   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 38.2</span></span>
<span><span class="co">#&gt; $ spouseID_median <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 15</span></span>
<span><span class="co">#&gt; $ spouseID_min    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1</span></span>
<span><span class="co">#&gt; $ spouseID_max    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 106</span></span>
<span><span class="co">#&gt; $ spouseID_sd     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 44.15118</span></span>
<span><span class="co">#&gt; $ sex_mean        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.5135135</span></span>
<span><span class="co">#&gt; $ sex_median      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1</span></span>
<span><span class="co">#&gt; $ sex_min         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0</span></span>
<span><span class="co">#&gt; $ sex_max         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1</span></span>
<span><span class="co">#&gt; $ sex_sd          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.5067117</span></span></code></pre></div>
<p>If we didn’t know to look for duplicates, we might not notice the
issue. Indeed, only of the duplicates was selected as are founder
member. However, the <code>checkIDs</code> function can help us identify
and repair these errors:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Call the checkIDs</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkIDs.html">checkIDs</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; $all_unique_ids</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 2 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_father</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_mother</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_duplicated_parents</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>As we can see from this output, there are 4 non-unique IDs in the
dataset, specifically 2, 6. Let’s take a peek at the duplicates:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">personID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">result</span><span class="op">$</span><span class="va">non_unique_ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">personID</span><span class="op">)</span></span>
<span><span class="co">#&gt;    personID newFamID famID             name gen momID dadID spouseID sex</span></span>
<span><span class="co">#&gt; 1         2        1     1   Vernon Dursley   1   101   102        3   1</span></span>
<span><span class="co">#&gt; 2         2        1     1 Marjorie Dursley   1   101   102       NA   0</span></span>
<span><span class="co">#&gt; 6         6        1     1   Dudley Dursley   2     3     1       NA   1</span></span>
<span><span class="co">#&gt; 61        6        1     1   Dudley Dursley   2     3     1       NA   1</span></span></code></pre></div>
<p>Yep, these are definitely the duplicates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_repair</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkIDs.html">checkIDs</a></span><span class="op">(</span><span class="va">df</span>, repair <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_repair</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">result</span><span class="op">$</span><span class="va">non_unique_ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span></span>
<span><span class="co">#&gt;   ID newFamID fam             name gen momID dadID spt sex</span></span>
<span><span class="co">#&gt; 1  2        1   1   Vernon Dursley   1   101   102   3   1</span></span>
<span><span class="co">#&gt; 2  2        1   1 Marjorie Dursley   1   101   102  NA   0</span></span>
<span><span class="co">#&gt; 6  6        1   1   Dudley Dursley   2     3     1  NA   1</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkIDs.html">checkIDs</a></span><span class="op">(</span><span class="va">df_repair</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; $all_unique_ids</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_father</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_mother</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_duplicated_parents</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Great! The function was able to repair the full duplicate, without
any manual intervention. That still leaves us with the sibling
overwrite, but that’s a more complex issue that would require manual
intervention. We’ll leave that for now.</p>
</div>
<div class="section level4">
<h4 id="handling-within-row-duplicates">Handling Within-Row Duplicates<a class="anchor" aria-label="anchor" href="#handling-within-row-duplicates"></a>
</h4>
<p>Sometimes, an individual’s parents’ IDs may be incorrectly listed as
their own ID, leading to within-row duplicates. The checkIDs function
can also identify these errors:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a sample dataset with within-person duplicate parent IDs</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ped2fam.html">ped2fam</a></span><span class="op">(</span><span class="va">potter</span>, famID <span class="op">=</span> <span class="st">"newFamID"</span>, personID <span class="op">=</span> <span class="st">"personID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">momID</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Vernon Dursley"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">personID</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Vernon Dursley"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Check for within-row duplicates</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkIDs.html">checkIDs</a></span><span class="op">(</span><span class="va">df</span>, repair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; $all_unique_ids</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_father</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_mother</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_duplicated_parents</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $is_own_mother_ids</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>In this example, we have created a within-row duplicate by setting
the momID of Vernon Dursley to his own ID. The <code>checkIDs</code>
function correctly identifies this error.</p>
</div>
</div>
<div class="section level3">
<h3 id="verifying-sex-coding">Verifying Sex Coding<a class="anchor" aria-label="anchor" href="#verifying-sex-coding"></a>
</h3>
<p>Another common issue in pedigree data is incorrect coding of
biological sex. In genetic studies, ensuring accurate recording of
biological sex in pedigree data is crucial for analyses that rely on
this information. The <code>checkSex</code> function in
<code>BGmisc</code> helps identify and repair errors related to
biological sex coding, such as inconsistencies where an individual’s sex
is incorrectly recorded. An example of this would be a parent who is
biologically male, but listed as a mother. The <code>checkSex</code>
function can help identify and correct such errors.</p>
<p>It is essential to distinguish between biological sex (genotype) and
gender identity (phenotype). Biological sex is based on chromosomes and
other biological characteristics, while gender identity is a broader,
richer, personal, deeply-held sense of being male, female, a blend of
both, neither, or another gender entirely. While <code>checkSex</code>
focuses on biological sex necessary for genetic analysis, we respect and
recognize the full spectrum of gender identities beyond the binary. The
developers of this package affirm their support for folx in the LGBTQ+
community.</p>
<p>The <code>checkSex</code> function in <code>BGmisc</code> performs
two main tasks: identifying possible errors and inconsistencies for
variables related to biological sex. The function is capable of
validating the sex coding in a pedigree and optionally repairing the sex
coding based on specified logic. Here’s how you can use the
<code>checkSex</code> function to validate and optionally repair sex
coding in a pedigree dataset:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Validate sex coding</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkSex.html">checkSex</a></span><span class="op">(</span><span class="va">potter</span>, code_male <span class="op">=</span> <span class="fl">1</span>, code_female <span class="op">=</span> <span class="fl">0</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, repair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Step 1: Checking how many sexes/genders...</span></span>
<span><span class="co">#&gt; 2 unique values found.</span></span>
<span><span class="co">#&gt;  1 2 unique values found.</span></span>
<span><span class="co">#&gt;  0Checks Made:</span></span>
<span><span class="co">#&gt; $sex_unique</span></span>
<span><span class="co">#&gt; [1] 1 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sex_length</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $all_sex_dad</span></span>
<span><span class="co">#&gt; [1] "1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $all_sex_mom</span></span>
<span><span class="co">#&gt; [1] "0"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $most_frequent_sex_dad</span></span>
<span><span class="co">#&gt; [1] "1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $most_frequent_sex_mom</span></span>
<span><span class="co">#&gt; [1] "0"</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt; $sex_unique</span></span>
<span><span class="co">#&gt; [1] 1 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sex_length</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $all_sex_dad</span></span>
<span><span class="co">#&gt; [1] "1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $all_sex_mom</span></span>
<span><span class="co">#&gt; [1] "0"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $most_frequent_sex_dad</span></span>
<span><span class="co">#&gt; [1] "1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $most_frequent_sex_mom</span></span>
<span><span class="co">#&gt; [1] "0"</span></span></code></pre></div>
<p>In this example, the checkSex function checks the unique values in
the sex column and identifies any inconsistencies in the sex coding of
parents. The function returns a list containing validation results, such
as the unique values found in the sex column and any inconsistencies in
the sex coding of parents.</p>
<p>If incorrect sex codes are found, you can attempt to repair them
automatically using the repair argument:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Repair sex coding</span></span>
<span><span class="va">df_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkSex.html">checkSex</a></span><span class="op">(</span><span class="va">potter</span>, code_male <span class="op">=</span> <span class="fl">1</span>, code_female <span class="op">=</span> <span class="fl">0</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, repair <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Step 1: Checking how many sexes/genders...</span></span>
<span><span class="co">#&gt; 2 unique values found.</span></span>
<span><span class="co">#&gt;  1 2 unique values found.</span></span>
<span><span class="co">#&gt;  0Step 2: Attempting to repair sex coding...</span></span>
<span><span class="co">#&gt; Changes Made:</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "Recode sex based on most frequent sex in dads: 1. Total gender changes made: 36"</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_fix</span><span class="op">)</span></span>
<span><span class="co">#&gt;     ID fam               name gen momID dadID spt sex</span></span>
<span><span class="co">#&gt; 1    1   1     Vernon Dursley   1   101   102   3   M</span></span>
<span><span class="co">#&gt; 2    2   1   Marjorie Dursley   1   101   102  NA   F</span></span>
<span><span class="co">#&gt; 3    3   1      Petunia Evans   1   103   104   1   F</span></span>
<span><span class="co">#&gt; 4    4   1         Lily Evans   1   103   104   5   F</span></span>
<span><span class="co">#&gt; 5    5   1       James Potter   1    NA    NA   4   M</span></span>
<span><span class="co">#&gt; 6    6   1     Dudley Dursley   2     3     1  NA   M</span></span>
<span><span class="co">#&gt; 7    7   1       Harry Potter   2     4     5   8   M</span></span>
<span><span class="co">#&gt; 8    8   1      Ginny Weasley   2    10     9   7   F</span></span>
<span><span class="co">#&gt; 9    9   1     Arthur Weasley   1    NA    NA  10   M</span></span>
<span><span class="co">#&gt; 10  10   1      Molly Prewett   1    NA    NA   9   F</span></span>
<span><span class="co">#&gt; 11  11   1        Ron Weasley   2    10     9  17   M</span></span>
<span><span class="co">#&gt; 12  12   1       Fred Weasley   2    10     9  NA   M</span></span>
<span><span class="co">#&gt; 13  13   1     George Weasley   2    10     9  NA   M</span></span>
<span><span class="co">#&gt; 14  14   1      Percy Weasley   2    10     9  20   M</span></span>
<span><span class="co">#&gt; 15  15   1    Charlie Weasley   2    10     9  NA   M</span></span>
<span><span class="co">#&gt; 16  16   1       Bill Weasley   2    10     9  18   M</span></span>
<span><span class="co">#&gt; 17  17   1   Hermione Granger   2    NA    NA  11   F</span></span>
<span><span class="co">#&gt; 18  18   1     Fleur Delacour   2   105   106  16   F</span></span>
<span><span class="co">#&gt; 19  19   1 Gabrielle Delacour   2   105   106  NA   F</span></span>
<span><span class="co">#&gt; 20  20   1     Audrey UNKNOWN   2    NA    NA  14   F</span></span>
<span><span class="co">#&gt; 21  21   1    James Potter II   3     8     7  NA   M</span></span>
<span><span class="co">#&gt; 22  22   1       Albus Potter   3     8     7  NA   M</span></span>
<span><span class="co">#&gt; 23  23   1        Lily Potter   3     8     7  NA   F</span></span>
<span><span class="co">#&gt; 24  24   1       Rose Weasley   3    17    11  NA   F</span></span>
<span><span class="co">#&gt; 25  25   1       Hugo Weasley   3    17    11  NA   M</span></span>
<span><span class="co">#&gt; 26  26   1   Victoire Weasley   3    18    16  NA   F</span></span>
<span><span class="co">#&gt; 27  27   1  Dominique Weasley   3    18    16  NA   F</span></span>
<span><span class="co">#&gt; 28  28   1      Louis Weasley   3    18    16  NA   M</span></span>
<span><span class="co">#&gt; 29  29   1      Molly Weasley   3    20    14  NA   F</span></span>
<span><span class="co">#&gt; 30  30   1       Lucy Weasley   3    20    14  NA   F</span></span>
<span><span class="co">#&gt; 31 101   1     Mother Dursley   0    NA    NA 102   F</span></span>
<span><span class="co">#&gt; 32 102   1     Father Dursley   0    NA    NA 101   M</span></span>
<span><span class="co">#&gt; 33 104   1       Father Evans   0    NA    NA 103   M</span></span>
<span><span class="co">#&gt; 34 103   1       Mother Evans   0    NA    NA 104   F</span></span>
<span><span class="co">#&gt; 35 106   1    Father Delacour   0    NA    NA 105   M</span></span>
<span><span class="co">#&gt; 36 105   1    Mother Delacour   0    NA    NA 106   F</span></span></code></pre></div>
<p>When the repair argument is set to TRUE, the function attempts to
repair the sex coding based on specified logic. It recodes the sex
variable based on the most frequent sex values found among parents. This
ensures that the sex coding is consistent and accurate, which is
essential for constructing valid genetic pedigrees.</p>
<!--
## Practical Example: Cleaning a Pedigree

Below is an example of how to clean and repair a pedigree dataset using the BGmisc package. This example is based on the approach Mason typically takes for data cleaning.


``` r
# note, is broken right now
# Load necessary libraries and datasets
library(tidyverse)
library(BGmisc)
set.seed(123)
# Create a sample dataset similar to the one used in Mason's approach
sample_data <- data.frame(
  ID = 1:10,
  name = c("Person1", "Person2", "Person3", "Person4", "Person5", "Person6", "Person7", "Person8", "Person9", "Person10"),
  dadID = c(NA, NA, 1, 1, 3, 3, 5, 5, 7, 7),
  momID = c(NA, NA, 2, 2, 4, 4, 6, 6, 7, 8),
  sex = c(1, 0, 1, 0, 1, 0, 1, 0, 1, 0),
  byr = runif(10, 1900, 2000),
  dyr = c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA)
)



summarizePedigrees(sample_data)


# Clean the sample dataset
cleaned_data <- sample_data %>%
  janitor::remove_empty(c("rows", "cols")) %>%
  mutate(
    sex_factor = as.factor(case_when(sex == 1 ~ "male", sex == 0 ~ "female"))
  )

# Check for duplicate IDs
temp_check <- checkIDs(cleaned_data, verbose = TRUE, repair = FALSE)
 all_duplicated_ids   <- cbind(temp_check$non_unique_ids, temp_check$duplicated_parents_ids)

cleaned_data <- cleaned_data %>%
  mutate(
    duplicated = case_when(ID %in% temp_check$non_unique_ids ~ 1, TRUE ~ 0),
    duplicated_parent = case_when(dadID %in% all_duplicated_ids  | momID %in% all_duplicated_ids  ~ 1, TRUE ~ 0),
    duplicated_source_ID = case_when(ID %in% all_duplicated_ids ~ ID, dadID %in% all_duplicated_ids  ~ dadID, momID %in% all_duplicated_ids  ~ momID, TRUE ~ NA_integer_),
    alteredlinks = 0
  )

# Display and manually correct specific errors
cleaned_data %>%
  filter(duplicated == 1 | duplicated_parent == 1) %>%
  arrange(duplicated_source_ID, ID) %>%
  print(n = Inf)

# Perform specific corrections
cleaned_data <- cleaned_data %>%
  mutate(
    alteredlinks = case_when(ID == 9  ~ 1, TRUE ~ alteredlinks),
    ID = case_when(ID == 7 & round(byr, digits = 0) == 2020 ~ ID + 1e6, TRUE ~ ID)
  )

# Final check for remaining duplicates
final_check <- checkIDs(cleaned_data, verbose = TRUE, repair = FALSE)
print(final_check)

```
-->
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette demonstrates how to use the BGmisc package to identify
and repair errors in pedigrees. By leveraging functions like checkIDs,
checkSex, and recodeSex, you can ensure the integrity of your pedigree
data, facilitating accurate analysis and research.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by S. Mason Garrison, Michael D. Hunter, Xuanyu Lyu, Jonathan D. Trattner, S. Alexandra Burt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
