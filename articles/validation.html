<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Validating and Repairing Pedigree Data with BGmisc • BGmisc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validating and Repairing Pedigree Data with BGmisc">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BGmisc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/analyticrelatedness.html">Calculating and Inferring Relatedness Coefficients with BGmisc</a></li>
    <li><a class="dropdown-item" href="../articles/modelingrelatedness.html">Modeling and Relatedness</a></li>
    <li><a class="dropdown-item" href="../articles/network.html">Network tools for finding extended pedigrees and path tracing</a></li>
    <li><a class="dropdown-item" href="../articles/partial.html">Adjacency matrix methods</a></li>
    <li><a class="dropdown-item" href="../articles/pedigree.html">Pedigree Simulation and Visualization with BGmisc</a></li>
    <li><a class="dropdown-item" href="../articles/validation.html">Validating and Repairing Pedigree Data with BGmisc</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-Computing-Lab/BGmisc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Validating and Repairing Pedigree Data with BGmisc</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/R-Computing-Lab/BGmisc/blob/main/vignettes/validation.Rmd" class="external-link"><code>vignettes/validation.Rmd</code></a></small>
      <div class="d-none name"><code>validation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Working with pedigree data often involves dealing with
inconsistencies, missing information, and errors. The
<code>BGmisc</code> package provides tools to identify and, where
possible, repair these issues automatically. This vignette demonstrates
how to validate and clean pedigree data using <code>BGmisc</code>’s
validation functions.</p>
</div>
<div class="section level2">
<h2 id="identifying-and-repairing-id-issues">Identifying and Repairing ID Issues<a class="anchor" aria-label="anchor" href="#identifying-and-repairing-id-issues"></a>
</h2>
<p>The <code><a href="../reference/checkIDs.html">checkIDs()</a></code> function detects two types of common ID
errors in pedigree data:</p>
<ul>
<li>Between-row duplication: When two or more individuals share the same
ID</li>
<li>Within-row duplication: When an individual’s parents’ IDs are
incorrectly listed as their own ID</li>
</ul>
<p>These problems are especially common when merging family records or
processing historical data. Let’s explore how they show up — and what
they imply for downstream structure.</p>
<div class="section level3">
<h3 id="a-clean-dataset">A Clean Dataset<a class="anchor" aria-label="anchor" href="#a-clean-dataset"></a>
</h3>
<p>We’ll begin with the Potter family dataset, cleaned and reformatted
with <code><a href="../reference/ped2fam.html">ped2fam()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/R-Computing-Lab/BGmisc/" class="external-link">BGmisc</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load our example dataset</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ped2fam.html">ped2fam</a></span><span class="op">(</span><span class="va">potter</span>, famID <span class="op">=</span> <span class="st">"newFamID"</span>, personID <span class="op">=</span> <span class="st">"personID"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check for ID issues</span></span>
<span><span class="fu"><a href="../reference/checkIDs.html">checkIDs</a></span><span class="op">(</span><span class="va">df</span>, repair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $all_unique_ids</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_father</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_mother</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_duplicated_parents</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>There are no duplicated or self-referential IDs here. But things
rarely stay that simple.</p>
<div class="section level4">
<h4 id="what-checkids-reports">What <code>checkIDs()</code> Reports<a class="anchor" aria-label="anchor" href="#what-checkids-reports"></a>
</h4>
<p>The <code><a href="../reference/checkIDs.html">checkIDs()</a></code> function checks for:</p>
<ul>
<li>Whether all IDs are unique (reported by <code>all_unique_ids</code>,
which tells you if all IDs in the dataset are unique, and
<code>total_non_unique_ids</code>, which gives you the count of
non-unique IDs found)</li>
<li>Cases where someone’s ID matches their parent’s ID (shown in
<code>total_own_father</code> and <code>total_own_mother</code>, which
count individuals whose father’s or mother’s ID matches their own
ID)</li>
<li>Total duplicated parent IDs (tracked by
<code>total_duplicated_parents</code>, which counts individuals with
duplicated parent IDs)</li>
<li>Within-row duplicates (measured by
<code>total_within_row_duplicates</code> showing the count and
<code>within_row_duplicates</code> indicating their presence)</li>
</ul>
<p>If you set <code>repair = TRUE</code>, the function will attempt to
fix the issues it finds. We’ll explore this later.</p>
</div>
</div>
<div class="section level3">
<h3 id="a-tale-of-two-duplicates">A Tale of Two Duplicates<a class="anchor" aria-label="anchor" href="#a-tale-of-two-duplicates"></a>
</h3>
<p>To understand how these tools work in practice, let’s create a
dataset with two common real-world problems. First, we’ll accidentally
give Vernon Dursley the same ID as his sister Marjorie (a common issue
when merging family records). Then, we’ll add a complete duplicate of
Dudley Dursley (as might happen during data entry).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create our problematic dataset</span></span>
<span><span class="va">df_duplicates</span> <span class="op">&lt;-</span> <span class="va">df</span></span>
<span><span class="co"># Sibling ID conflict</span></span>
<span><span class="va">df_duplicates</span><span class="op">$</span><span class="va">personID</span><span class="op">[</span><span class="va">df_duplicates</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Vernon Dursley"</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">df_duplicates</span><span class="op">$</span><span class="va">personID</span><span class="op">[</span><span class="va">df_duplicates</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Marjorie Dursley"</span><span class="op">]</span></span>
<span><span class="co"># Duplicate entry</span></span>
<span><span class="va">df_duplicates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">df_duplicates</span>,</span>
<span>  <span class="va">df_duplicates</span><span class="op">[</span><span class="va">df_duplicates</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Dudley Dursley"</span>, <span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If we look at the data using standard tools, the problems aren’t
immediately obvious:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summarizeFamilies.html">summarizeFamilies</a></span><span class="op">(</span><span class="va">df_duplicates</span>,</span>
<span>  famID <span class="op">=</span> <span class="st">"newFamID"</span>,</span>
<span>  personID <span class="op">=</span> <span class="st">"personID"</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">family_summary</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 1</span></span>
<span><span class="co">#&gt; Columns: 17</span></span>
<span><span class="co">#&gt; $ newFamID        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1</span></span>
<span><span class="co">#&gt; $ count           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 37</span></span>
<span><span class="co">#&gt; $ gen_mean        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.756757</span></span>
<span><span class="co">#&gt; $ gen_median      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2</span></span>
<span><span class="co">#&gt; $ gen_min         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0</span></span>
<span><span class="co">#&gt; $ gen_max         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3</span></span>
<span><span class="co">#&gt; $ gen_sd          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.038305</span></span>
<span><span class="co">#&gt; $ spouseID_mean   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 38.2</span></span>
<span><span class="co">#&gt; $ spouseID_median <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 15</span></span>
<span><span class="co">#&gt; $ spouseID_min    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1</span></span>
<span><span class="co">#&gt; $ spouseID_max    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 106</span></span>
<span><span class="co">#&gt; $ spouseID_sd     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 44.15118</span></span>
<span><span class="co">#&gt; $ sex_mean        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.5135135</span></span>
<span><span class="co">#&gt; $ sex_median      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1</span></span>
<span><span class="co">#&gt; $ sex_min         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0</span></span>
<span><span class="co">#&gt; $ sex_max         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1</span></span>
<span><span class="co">#&gt; $ sex_sd          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.5067117</span></span></code></pre></div>
<p>But <code><a href="../reference/checkIDs.html">checkIDs()</a></code> detects the problems clearly:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Identify duplicates</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkIDs.html">checkIDs</a></span><span class="op">(</span><span class="va">df_duplicates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; $all_unique_ids</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 2 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_father</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_mother</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_duplicated_parents</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>As we can see from this output, there are 4 non-unique IDs in the
dataset, specifically 2, 6. Let’s take a peek at the duplicates:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's examine the problematic entries</span></span>
<span><span class="va">df_duplicates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">personID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">result</span><span class="op">$</span><span class="va">non_unique_ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">personID</span><span class="op">)</span></span>
<span><span class="co">#&gt;    personID newFamID famID             name gen momID dadID spouseID sex</span></span>
<span><span class="co">#&gt; 1         2        1     1   Vernon Dursley   1   101   102        3   1</span></span>
<span><span class="co">#&gt; 2         2        1     1 Marjorie Dursley   1   101   102       NA   0</span></span>
<span><span class="co">#&gt; 6         6        1     1   Dudley Dursley   2     3     1       NA   1</span></span>
<span><span class="co">#&gt; 61        6        1     1   Dudley Dursley   2     3     1       NA   1</span></span></code></pre></div>
<p>Yep, these are definitely the duplicates.</p>
<div class="section level4">
<h4 id="repairing-between-row-duplicates">Repairing Between-Row Duplicates<a class="anchor" aria-label="anchor" href="#repairing-between-row-duplicates"></a>
</h4>
<p>Some ID issues can be fixed automatically. Let’s try the repair
option:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_repair</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkIDs.html">checkIDs</a></span><span class="op">(</span><span class="va">df</span>, repair <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_repair</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">result</span><span class="op">$</span><span class="va">non_unique_ids</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span></span>
<span><span class="co">#&gt;   ID newFamID fam             name gen momID dadID spID sex</span></span>
<span><span class="co">#&gt; 1  2        1   1 Marjorie Dursley   1   101   102   NA   0</span></span>
<span><span class="co">#&gt; 2  6        1   1   Dudley Dursley   2     3     1   NA   1</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkIDs.html">checkIDs</a></span><span class="op">(</span><span class="va">df_repair</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; $all_unique_ids</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_father</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_mother</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_duplicated_parents</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Great! Notice what happened here: the function was able to repair the
full duplicate, without any manual intervention. That still leaves us
with the sibling ID conflict, but that’s a more complex issue that would
require manual intervention. We’ll leave that for now.</p>
<p>So far we’ve only checked for violations of uniqueness. But do these
errors also affect the graph structure? Let’s find out.</p>
</div>
</div>
<div class="section level3">
<h3 id="oedipus-id">Oedipus ID<a class="anchor" aria-label="anchor" href="#oedipus-id"></a>
</h3>
<p>Just as Oedipus discovered his true relationship was not what records
suggested, our data can reveal its own confused parentage when an ID is
incorrectly listed as its own parent. Let’s examine this error:</p>
<p>Sometimes, an individual’s parents’ IDs may be incorrectly listed as
their own ID, leading to within-row duplicates. The checkIDs function
can also identify these errors:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a sample dataset with within-person duplicate parent IDs</span></span>
<span></span>
<span><span class="va">df_within</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ped2fam.html">ped2fam</a></span><span class="op">(</span><span class="va">potter</span>, famID <span class="op">=</span> <span class="st">"newFamID"</span>, personID <span class="op">=</span> <span class="st">"personID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_within</span><span class="op">$</span><span class="va">momID</span><span class="op">[</span><span class="va">df_within</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Vernon Dursley"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">df_within</span><span class="op">$</span><span class="va">personID</span><span class="op">[</span><span class="va">df_within</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Vernon Dursley"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Check for within-row duplicates</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkIDs.html">checkIDs</a></span><span class="op">(</span><span class="va">df_within</span>, repair <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; $all_unique_ids</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_non_unique_ids</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_father</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_own_mother</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_duplicated_parents</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_row_duplicates</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $is_own_mother_ids</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>In this example, we have created a within-row duplicate by setting
the momID of Vernon Dursley to his own ID. The <code>checkIDs</code>
function correctly identifies that this error is present.</p>
<p>To repair within-row duplicates, you will be able to set the repair
argument to <code>TRUE</code>, eventually. This feature is currently
under development and will be available in future versions of the
package. In the meantime, you can manually inspect and then correct
these errors in your dataset.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the problematic entry</span></span>
<span></span>
<span><span class="va">df_within</span><span class="op">[</span><span class="va">df_within</span><span class="op">$</span><span class="va">momID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">result</span><span class="op">$</span><span class="va">is_own_mother_ids</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;   personID newFamID famID           name gen momID dadID spouseID sex</span></span>
<span><span class="co">#&gt; 1        1        1     1 Vernon Dursley   1     1   102        3   1</span></span></code></pre></div>
<p>There are several ways to correct this issue, depending on the
specifics of your dataset. In this case, you could correct the momID for
Vernon Dursley to the correct value, resolving the within-row duplicate,
likely by assuming that his sister Marjorie shares the same mother.</p>
</div>
</div>
<div class="section level2">
<h2 id="identifying-and-repairing-sex-coding-issues">Identifying and Repairing Sex Coding Issues<a class="anchor" aria-label="anchor" href="#identifying-and-repairing-sex-coding-issues"></a>
</h2>
<p>Another critical aspect of pedigree validation is ensuring the
consistency of sex coding. This brings us to an important distinction in
genetic studies between biological sex (genotype) and gender identity
(phenotype):</p>
<ul>
<li>Biological sex (genotype) refers to an individual’s chromosomal
configuration, typically XX for female and XY for male in humans, though
variations exist.</li>
<li>Gender identity (phenotype) encompasses a broader, richer, personal,
deeply-held sense of being male, female, a blend of both, neither, or
another gender entirely.</li>
</ul>
<p>The <code>checkSex</code> function focuses on biological sex coding
consistency, particularly looking for: - Mismatches between parent roles
and recorded sex - Individuals listed as both parent and child -
Inconsistent sex coding across the dataset</p>
<p>Let’s examine how it works:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Validate sex coding</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkSex.html">checkSex</a></span><span class="op">(</span><span class="va">potter</span>,</span>
<span>  code_male <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  code_female <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>, repair <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Step 1: Checking how many sexes/genders...</span></span>
<span><span class="co">#&gt; 2 unique values found.</span></span>
<span><span class="co">#&gt; Unique values: 1, 0</span></span>
<span><span class="co">#&gt; Checks Made:</span></span>
<span><span class="co">#&gt; $sex_unique</span></span>
<span><span class="co">#&gt; [1] 1 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sex_length</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $all_sex_dad</span></span>
<span><span class="co">#&gt; [1] "1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $all_sex_mom</span></span>
<span><span class="co">#&gt; [1] "0"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $most_frequent_sex_dad</span></span>
<span><span class="co">#&gt; [1] "1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $most_frequent_sex_mom</span></span>
<span><span class="co">#&gt; [1] "0"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt; $sex_unique</span></span>
<span><span class="co">#&gt; [1] 1 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sex_length</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $all_sex_dad</span></span>
<span><span class="co">#&gt; [1] "1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $all_sex_mom</span></span>
<span><span class="co">#&gt; [1] "0"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $most_frequent_sex_dad</span></span>
<span><span class="co">#&gt; [1] "1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $most_frequent_sex_mom</span></span>
<span><span class="co">#&gt; [1] "0"</span></span></code></pre></div>
<p>When inconsistencies are found, you can attempt automatic repair:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Repair sex coding</span></span>
<span><span class="va">df_fix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkSex.html">checkSex</a></span><span class="op">(</span><span class="va">potter</span>,</span>
<span>  code_male <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  code_female <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>, repair <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Step 1: Checking how many sexes/genders...</span></span>
<span><span class="co">#&gt; 2 unique values found.</span></span>
<span><span class="co">#&gt; Unique values: 1, 0</span></span>
<span><span class="co">#&gt; Step 2: Attempting to repair sex coding...</span></span>
<span><span class="co">#&gt; Changes Made:</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "Recode sex based on most frequent sex in dads: 1. Total sex changes made:  36"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_fix</span><span class="op">)</span></span>
<span><span class="co">#&gt;     ID fam               name gen momID dadID spID sex</span></span>
<span><span class="co">#&gt; 1    1   1     Vernon Dursley   1   101   102    3   M</span></span>
<span><span class="co">#&gt; 2    2   1   Marjorie Dursley   1   101   102   NA   F</span></span>
<span><span class="co">#&gt; 3    3   1      Petunia Evans   1   103   104    1   F</span></span>
<span><span class="co">#&gt; 4    4   1         Lily Evans   1   103   104    5   F</span></span>
<span><span class="co">#&gt; 5    5   1       James Potter   1    NA    NA    4   M</span></span>
<span><span class="co">#&gt; 6    6   1     Dudley Dursley   2     3     1   NA   M</span></span>
<span><span class="co">#&gt; 7    7   1       Harry Potter   2     4     5    8   M</span></span>
<span><span class="co">#&gt; 8    8   1      Ginny Weasley   2    10     9    7   F</span></span>
<span><span class="co">#&gt; 9    9   1     Arthur Weasley   1    NA    NA   10   M</span></span>
<span><span class="co">#&gt; 10  10   1      Molly Prewett   1    NA    NA    9   F</span></span>
<span><span class="co">#&gt; 11  11   1        Ron Weasley   2    10     9   17   M</span></span>
<span><span class="co">#&gt; 12  12   1       Fred Weasley   2    10     9   NA   M</span></span>
<span><span class="co">#&gt; 13  13   1     George Weasley   2    10     9   NA   M</span></span>
<span><span class="co">#&gt; 14  14   1      Percy Weasley   2    10     9   20   M</span></span>
<span><span class="co">#&gt; 15  15   1    Charlie Weasley   2    10     9   NA   M</span></span>
<span><span class="co">#&gt; 16  16   1       Bill Weasley   2    10     9   18   M</span></span>
<span><span class="co">#&gt; 17  17   1   Hermione Granger   2    NA    NA   11   F</span></span>
<span><span class="co">#&gt; 18  18   1     Fleur Delacour   2   105   106   16   F</span></span>
<span><span class="co">#&gt; 19  19   1 Gabrielle Delacour   2   105   106   NA   F</span></span>
<span><span class="co">#&gt; 20  20   1     Audrey UNKNOWN   2    NA    NA   14   F</span></span>
<span><span class="co">#&gt; 21  21   1    James Potter II   3     8     7   NA   M</span></span>
<span><span class="co">#&gt; 22  22   1       Albus Potter   3     8     7   NA   M</span></span>
<span><span class="co">#&gt; 23  23   1        Lily Potter   3     8     7   NA   F</span></span>
<span><span class="co">#&gt; 24  24   1       Rose Weasley   3    17    11   NA   F</span></span>
<span><span class="co">#&gt; 25  25   1       Hugo Weasley   3    17    11   NA   M</span></span>
<span><span class="co">#&gt; 26  26   1   Victoire Weasley   3    18    16   NA   F</span></span>
<span><span class="co">#&gt; 27  27   1  Dominique Weasley   3    18    16   NA   F</span></span>
<span><span class="co">#&gt; 28  28   1      Louis Weasley   3    18    16   NA   M</span></span>
<span><span class="co">#&gt; 29  29   1      Molly Weasley   3    20    14   NA   F</span></span>
<span><span class="co">#&gt; 30  30   1       Lucy Weasley   3    20    14   NA   F</span></span>
<span><span class="co">#&gt; 31 101   1     Mother Dursley   0    NA    NA  102   F</span></span>
<span><span class="co">#&gt; 32 102   1     Father Dursley   0    NA    NA  101   M</span></span>
<span><span class="co">#&gt; 33 104   1       Father Evans   0    NA    NA  103   M</span></span>
<span><span class="co">#&gt; 34 103   1       Mother Evans   0    NA    NA  104   F</span></span>
<span><span class="co">#&gt; 35 106   1    Father Delacour   0    NA    NA  105   M</span></span>
<span><span class="co">#&gt; 36 105   1    Mother Delacour   0    NA    NA  106   F</span></span></code></pre></div>
<p>When the repair argument is set to <code>TRUE</code>, repair process
follows several rules: - Parents listed as mothers must be female -
Parents listed as fathers must be male - Sex codes are standardized to
the specified code_male and code_female values - If no sex code is
provided, the function will attempt to infer what male and female are
coded with. The most frequently assigned sex for mothers and fathers
will be used as the standard.</p>
<p>Note that automatic repairs should be carefully reviewed, as they may
not always reflect the correct biological relationships. In cases where
the sex coding is ambiguous or conflicts with known relationships,
manual inspection and domain knowledge may be required.</p>
<!--
## Practical Example: Cleaning a Pedigree

Below is an example of how to clean and repair a pedigree dataset using the BGmisc package. This example is based on the approach Mason typically takes for data cleaning.


``` r
# note, is broken right now
# Load necessary libraries and datasets
library(tidyverse)
library(BGmisc)
set.seed(123)
# Create a sample dataset similar to the one used in Mason's approach
sample_data <- data.frame(
  ID = 1:10,
  name = c("Person1", "Person2", "Person3", "Person4", "Person5", "Person6", "Person7", "Person8", "Person9", "Person10"),
  dadID = c(NA, NA, 1, 1, 3, 3, 5, 5, 7, 7),
  momID = c(NA, NA, 2, 2, 4, 4, 6, 6, 7, 8),
  sex = c(1, 0, 1, 0, 1, 0, 1, 0, 1, 0),
  byr = runif(10, 1900, 2000),
  dyr = c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA)
)



summarizePedigrees(sample_data)


# Clean the sample dataset
cleaned_data <- sample_data %>%
  janitor::remove_empty(c("rows", "cols")) %>%
  mutate(
    sex_factor = as.factor(case_when(sex == 1 ~ "male", sex == 0 ~ "female"))
  )

# Check for duplicate IDs
temp_check <- checkIDs(cleaned_data, verbose = TRUE, repair = FALSE)
all_duplicated_ids <- cbind(temp_check$non_unique_ids, temp_check$duplicated_parents_ids)

cleaned_data <- cleaned_data %>%
  mutate(
    duplicated = case_when(ID %in% temp_check$non_unique_ids ~ 1, TRUE ~ 0),
    duplicated_parent = case_when(dadID %in% all_duplicated_ids | momID %in% all_duplicated_ids ~ 1, TRUE ~ 0),
    duplicated_source_ID = case_when(ID %in% all_duplicated_ids ~ ID, dadID %in% all_duplicated_ids ~ dadID, momID %in% all_duplicated_ids ~ momID, TRUE ~ NA_integer_),
    alteredlinks = 0
  )

# Display and manually correct specific errors
cleaned_data %>%
  filter(duplicated == 1 | duplicated_parent == 1) %>%
  arrange(duplicated_source_ID, ID) %>%
  print(n = Inf)

# Perform specific corrections
cleaned_data <- cleaned_data %>%
  mutate(
    alteredlinks = case_when(ID == 9 ~ 1, TRUE ~ alteredlinks),
    ID = case_when(ID == 7 & round(byr, digits = 0) == 2020 ~ ID + 1e6, TRUE ~ ID)
  )

# Final check for remaining duplicates
final_check <- checkIDs(cleaned_data, verbose = TRUE, repair = FALSE)
print(final_check)
```
-->
</div>
<div class="section level2">
<h2 id="best-practices-for-pedigree-validation">Best Practices for Pedigree Validation<a class="anchor" aria-label="anchor" href="#best-practices-for-pedigree-validation"></a>
</h2>
<p>Through extensive work with pedigree data, we’ve learned several key
principles:</p>
<ul>
<li>Always inspect your data before applying automatic repairs</li>
<li>Use summarizeFamilies() to get an overview of family structures</li>
<li>Keep detailed records of changes made during cleaning</li>
<li>Validate after each repair step</li>
<li>Create backups before applying repairs</li>
<li>Trust your domain knowledge - automatic repairs are helpful but not
infallible</li>
</ul>
<p>By following these best practices, and leveraging functions like
<code>checkIDs</code>, <code>checkSex</code>, and
<code>recodeSex</code>, you can ensure the integrity of your pedigree
data, facilitating accurate analysis and research.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by S. Mason Garrison, Michael D. Hunter, Xuanyu Lyu, Jonathan D. Trattner, S. Alexandra Burt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
