<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ASOIAF: How related are Jon and Danny? • BGmisc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ASOIAF: How related are Jon and Danny?">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BGmisc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.5.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/analyticrelatedness.html">Calculating and Inferring Relatedness Coefficients with BGmisc</a></li>
    <li><a class="dropdown-item" href="../articles/ASOIAF.html">ASOIAF: How related are Jon and Danny?</a></li>
    <li><a class="dropdown-item" href="../articles/modelingrelatedness.html">Modeling variance components</a></li>
    <li><a class="dropdown-item" href="../articles/network.html">Network tools for finding extended pedigrees and path tracing</a></li>
    <li><a class="dropdown-item" href="../articles/partial.html">Adjacency matrix methods</a></li>
    <li><a class="dropdown-item" href="../articles/pedigree.html">Pedigree Simulation and Visualization with BGmisc</a></li>
    <li><a class="dropdown-item" href="../articles/validation.html">Validating and Repairing Pedigree Data with BGmisc</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-Computing-Lab/BGmisc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>ASOIAF: How related are Jon and Danny?</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/R-Computing-Lab/BGmisc/blob/main/vignettes/ASOIAF.Rmd" class="external-link"><code>vignettes/ASOIAF.Rmd</code></a></small>
      <div class="d-none name"><code>ASOIAF.Rmd</code></div>
    </div>

    
    
<p>Just how related are Jon Snow and Daenerys Targaryen? This vignette
walks through how to quantify their genetic relatedness using functions
from the BGmisc package. While the Game of Thrones canon gives us some
clues, we can use a formal pedigree-based approach to quantify their
genetic relatedness. This vignette demonstrates how to compute
coefficients of relatedness using the <code>BGmisc</code> package, along
with basic data manipulation from tidyverse. We will also handle
incomplete parental information programmatically and generate a plot of
the reconstructed pedigree.</p>
<div class="section level2">
<h2 id="load-packages-and-data">Load Packages and Data<a class="anchor" aria-label="anchor" href="#load-packages-and-data"></a>
</h2>
<p>We begin by loading the necessary packages and accessing the built-in
<code>ASOIAF</code> pedigree dataset included with
<code>BGmisc</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/R-Computing-Lab/BGmisc/" class="external-link">BGmisc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.5</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.5.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.4     </span></span>
<span><span class="co">## ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ASOIAF</span><span class="op">)</span></span></code></pre></div>
<p>The ASOIAF data contains character IDs, family identifiers, and
parent-child links extracted from A Song of Ice and Fire lore.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ASOIAF</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   id famID momID dadID          name sex</span></span>
<span><span class="co">## 1  1     1    NA    NA   Walder Frey   M</span></span>
<span><span class="co">## 2  2     1    NA    NA   Perra Royce   F</span></span>
<span><span class="co">## 3  3     1     2     1  Stevron Frey   M</span></span>
<span><span class="co">## 4  4     1     2     1    Emmon Frey   M</span></span>
<span><span class="co">## 5  5     1     2     1    Aenys Frey   M</span></span>
<span><span class="co">## 6  6     1    NA    NA Corenna Swann   F</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="prepare-and-validate-sex-codes">Prepare and Validate Sex Codes<a class="anchor" aria-label="anchor" href="#prepare-and-validate-sex-codes"></a>
</h2>
<p>We use <code><a href="../reference/checkSex.html">checkSex()</a></code> to ensure that all individuals have
valid sex codes, repairing as needed. This is important for correct
pedigree plotting and downstream calculations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_got</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkSex.html">checkSex</a></span><span class="op">(</span><span class="va">ASOIAF</span>,</span>
<span>  code_male <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  code_female <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>, repair <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="compute-relatedness-matrices">Compute Relatedness Matrices<a class="anchor" aria-label="anchor" href="#compute-relatedness-matrices"></a>
</h2>
<p>We now compute the additive genetic relatedness matrix (add) and the
common nuclear relatedness matrix (cn) from the pedigree using ped2com()
and ped2cn(), respectively. The <code>isChild_method</code> argument
specifies how to identify child-parent relationships. We use
“partialparent” to account for missing parent information. The
<code>adjacency_method</code> argument specifies how to construct the
adjacency matrix. We use “direct” for the additive matrix and “indexed”
for the common nuclear matrix. The direct method is much faster. The
<code>sparse</code> argument is set to FALSE to return dense
matrices.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">add</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ped2com.html">ped2com</a></span><span class="op">(</span><span class="va">df_got</span>,</span>
<span>  isChild_method <span class="op">=</span> <span class="st">"partialparent"</span>,</span>
<span>  component <span class="op">=</span> <span class="st">"additive"</span>,</span>
<span>  adjacency_method <span class="op">=</span> <span class="st">"direct"</span>,</span>
<span>  sparse <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ped2cn.html">ped2cn</a></span><span class="op">(</span><span class="va">df_got</span>,</span>
<span>  isChild_method <span class="op">=</span> <span class="st">"partialparent"</span>,</span>
<span>  adjacency_method <span class="op">=</span> <span class="st">"indexed"</span>,</span>
<span>  sparse <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="convert-to-pairwise-format">Convert to Pairwise Format<a class="anchor" aria-label="anchor" href="#convert-to-pairwise-format"></a>
</h2>
<p>We convert the component matrices into a long-format table of
pairwise relationships using <code><a href="../reference/com2links.html">com2links()</a></code>. This gives us a
long dataframe where each row represents a pair of individuals and their
relatedness. The function can return the entire matrix or just the lower
triangular part, which is often sufficient for our purposes. We set
<code>writetodisk = FALSE</code> to keep the data in memory.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_links</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/com2links.html">com2links</a></span><span class="op">(</span></span>
<span>  writetodisk <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ad_ped_matrix <span class="op">=</span> <span class="va">add</span>, cn_ped_matrix <span class="op">=</span> <span class="va">cn</span>,</span>
<span>  drop_upper_triangular <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span><span class="co"># %&gt;%</span></span>
<span><span class="co">#  filter(ID1 != ID2)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="locate-jon-and-daenerys">Locate Jon and Daenerys<a class="anchor" aria-label="anchor" href="#locate-jon-and-daenerys"></a>
</h2>
<p>Next, we extract the IDs corresponding to Jon Snow and Daenerys
Targaryen. We use the <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code> function to find the rows in
the <code>df_links</code> dataframe where either ID1 or ID2 corresponds
to Jon Snow, and then filter again to find the row where the other ID
corresponds to Daenerys Targaryen.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the IDs of Jon Snow and Daenerys Targaryen</span></span>
<span></span>
<span><span class="va">jon_id</span> <span class="op">&lt;-</span> <span class="va">df_got</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Jon Snow"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dany_id</span> <span class="op">&lt;-</span> <span class="va">df_got</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Daenerys Targaryen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span></span></code></pre></div>
<p>We then filter the pairwise table to retrieve the row containing
their relationship.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jon_dany_row</span> <span class="op">&lt;-</span> <span class="va">df_links</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID1</span> <span class="op">==</span> <span class="va">jon_id</span> <span class="op">|</span> <span class="va">ID2</span> <span class="op">==</span> <span class="va">jon_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">dany_id</span><span class="op">|</span> <span class="va">ID2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">dany_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jon_dany_row</span> </span></code></pre></div>
<pre><code><span><span class="co">##   ID1 ID2     addRel cnuRel</span></span>
<span><span class="co">## 1 206 211 0.31274414      0</span></span>
<span><span class="co">## 2 211 304 0.01953125      0</span></span></code></pre>
<p>This row contains the additive relatedness coefficient between Jon
and Daenerys, which allows us to assess how closely related they are
genetically. We’d expect to see a value of 0.25 for an Aunt-Nephew
relationship, which is what Jon and Daenerys are in the show. However,
the value is 0.3127441, indicating a more complex relationship.</p>
</div>
<div class="section level2">
<h2 id="plotting-the-pedigree-with-incomplete-parental-information">Plotting the Pedigree with incomplete parental information<a class="anchor" aria-label="anchor" href="#plotting-the-pedigree-with-incomplete-parental-information"></a>
</h2>
<p>To facilitate plotting, we check for individuals with one known
parent but a missing other. For those cases, we assign a placeholder ID
to the missing parent.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_repaired</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkParentIDs.html">checkParentIDs</a></span><span class="op">(</span><span class="va">df_got</span>,addphantoms<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                              repair<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                              parentswithoutrow<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                              repairsex<span class="op">=</span><span class="cn">FALSE</span></span>
<span>                              <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fam<span class="op">=</span><span class="fl">1</span>,</span>
<span>                                           affected <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">jon_id</span>,<span class="va">dany_id</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                                               <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span></span>
<span>                              <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## REPAIR IN EARLY ALPHA</span></span></code></pre>
<p>This code creates new IDs for individuals with one known parent and a
missing other. It checks if either <code>momID</code> or
<code>dadID</code> is missing, and if so, it assigns a new ID based on
the row number. This allows us to visualize the pedigree even when some
parental information is incomplete.</p>
</div>
<div class="section level2">
<h2 id="visualize-the-pedigree">Visualize the Pedigree<a class="anchor" aria-label="anchor" href="#visualize-the-pedigree"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#fixParents(id=df_got$ID, dadid=df_got$dadID, momid=df_got$momID, sex=df_got$sex, missid = NA)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotPedigree.html">plotPedigree</a></span><span class="op">(</span><span class="va">df_repaired</span>,affected<span class="op">=</span><span class="va">df_repaired</span><span class="op">$</span><span class="va">affected</span>,verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ASOIAF_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<pre><code><span><span class="co">## Did not plot the following people: 85 88 125 142 228 229 258 259 274 275 305 336 357 381 388 405 409 418 420 424 428 451 487</span></span></code></pre>
<pre><code><span><span class="co">## named list()</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by S. Mason Garrison, Michael D. Hunter, Xuanyu Lyu, Jonathan D. Trattner, S. Alexandra Burt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
