<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ASOIAF: How related are Jon and Danny? • BGmisc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ASOIAF: How related are Jon and Danny?">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BGmisc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v0_network.html">Network tools for finding extended pedigrees and path tracing</a></li>
    <li><a class="dropdown-item" href="../articles/v1_modelingvariancecomponents.html">Modeling variance components</a></li>
    <li><a class="dropdown-item" href="../articles/v2_pedigree.html">Pedigree Simulation and Visualization with BGmisc</a></li>
    <li><a class="dropdown-item" href="../articles/v3_analyticrelatedness.html">Understanding and Computing Relatedness from Pedigree Data</a></li>
    <li><a class="dropdown-item" href="../articles/v4_validation.html">Validating and Repairing Pedigree Data with BGmisc</a></li>
    <li><a class="dropdown-item" href="../articles/v5_ASOIAF.html">ASOIAF: How related are Jon and Danny?</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-Computing-Lab/BGmisc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>ASOIAF: How related are Jon and Danny?</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/R-Computing-Lab/BGmisc/blob/main/vignettes/v5_ASOIAF.Rmd" class="external-link"><code>vignettes/v5_ASOIAF.Rmd</code></a></small>
      <div class="d-none name"><code>v5_ASOIAF.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Just how closely related are Jon Snow and Daenerys Targaryen?
According to the lore of <em>A Song of Ice and Fire</em>, Daenerys is
Jon’s paternal aunt. This would suggest a theoretical genetic
relatedness of 0.25, assuming a simple pedigree and no inbreeding. But
with tangled ancestries and potentially missing information, how
confident can we be in that estimate?</p>
<p>In this vignette, we use the <code>BGmisc</code> package to
reconstruct the <em>ASOIAF</em> pedigree from the
<code>ggpedigree</code> package, handle incomplete parentage data, and
compute additive genetic and common nuclear relatedness. We’ll focus on
Jon and Daenerys as a case study, but the methods generalize to any
characters in the provided dataset.</p>
</div>
<div class="section level2">
<h2 id="load-packages-and-data">Load Packages and Data<a class="anchor" aria-label="anchor" href="#load-packages-and-data"></a>
</h2>
<p>We begin by loading the required libraries and examining the
structure of the built-in <code>ASOIAF</code> pedigree.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/R-Computing-Lab/BGmisc/" class="external-link">BGmisc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/R-Computing-Lab/ggpedigree/" class="external-link">ggpedigree</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ASOIAF</span>, package <span class="op">=</span> <span class="st">"ggpedigree"</span><span class="op">)</span></span></code></pre></div>
<p>The ASOIAF dataset includes character IDs, names, family identifiers,
and parent identifiers for a subset of characters drawn from the <em>A
Song of Ice and Fire</em> canon.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ASOIAF</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   id famID momID dadID          name sex</span></span>
<span><span class="co">## 1  1     1   566   564   Walder Frey   M</span></span>
<span><span class="co">## 2  2     1    NA    NA   Perra Royce   F</span></span>
<span><span class="co">## 3  3     1     2     1  Stevron Frey   M</span></span>
<span><span class="co">## 4  4     1     2     1    Emmon Frey   M</span></span>
<span><span class="co">## 5  5     1     2     1    Aenys Frey   M</span></span>
<span><span class="co">## 6  6     1    NA    NA Corenna Swann   F</span></span>
<span><span class="co">##                                                   url twinID zygosity</span></span>
<span><span class="co">## 1   https://awoiaf.westeros.org/index.php/Walder_Frey     NA     &lt;NA&gt;</span></span>
<span><span class="co">## 2   https://awoiaf.westeros.org/index.php/Perra_Royce     NA     &lt;NA&gt;</span></span>
<span><span class="co">## 3  https://awoiaf.westeros.org/index.php/Stevron_Frey     NA     &lt;NA&gt;</span></span>
<span><span class="co">## 4    https://awoiaf.westeros.org/index.php/Emmon_Frey     NA     &lt;NA&gt;</span></span>
<span><span class="co">## 5    https://awoiaf.westeros.org/index.php/Aenys_Frey     NA     &lt;NA&gt;</span></span>
<span><span class="co">## 6 https://awoiaf.westeros.org/index.php/Corenna_Swann     NA     &lt;NA&gt;</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="prepare-and-validate-sex-codes">Prepare and Validate Sex Codes<a class="anchor" aria-label="anchor" href="#prepare-and-validate-sex-codes"></a>
</h2>
<p>Many pedigree-based algorithms rely on biological sex for downstream
calculationss and visualization. We use <code><a href="../reference/checkSex.html">checkSex()</a></code> to
inspect the sex variable, repairing inconsistencies
programmatically.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_got</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkSex.html">checkSex</a></span><span class="op">(</span><span class="va">ASOIAF</span>,</span>
<span>  code_male <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  code_female <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>, repair <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="compute-relatedness-matrices">Compute Relatedness Matrices<a class="anchor" aria-label="anchor" href="#compute-relatedness-matrices"></a>
</h2>
<p>With validated pedigree data, we can now compute two distinct
relationship matrices:</p>
<ul>
<li><p>Additive genetic relatedness (add): Proportion of shared additive
genetic variance between individuals.</p></li>
<li><p>Common nuclear relatedness (cn): Indicates shared full-sibling
(nuclear family) environments.</p></li>
</ul>
<p>These are derived using <code>ped2add</code>() and
<code>ped2cn</code>(), respectively. Both functions rely on internal
graph traversal and adjacency structures. In this case:</p>
<ul>
<li><p>We specify isChild_method = “partialparent” to allow inclusion of
dyads where one parent is unknown.</p></li>
<li><p>We choose adjacency_method = “direct” for the additive matrix to
optimize for computational speed.</p></li>
<li><p>For the common nuclear matrix, we use adjacency_method =
“indexed”, which is slower but necessary for resolving sibling-group
structures.</p></li>
<li><p>We set <code>sparse = TRUE</code> to return compressed sparse
matrices rather than full (dense) formats.</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">add</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ped2com.html">ped2com</a></span><span class="op">(</span><span class="va">df_got</span>,</span>
<span>  isChild_method <span class="op">=</span> <span class="st">"partialparent"</span>,</span>
<span>  component <span class="op">=</span> <span class="st">"additive"</span>,</span>
<span>  adjacency_method <span class="op">=</span> <span class="st">"direct"</span>,</span>
<span>  sparse <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ped2com.html">ped2com</a></span><span class="op">(</span><span class="va">df_got</span>,</span>
<span>  isChild_method <span class="op">=</span> <span class="st">"partialparent"</span>,</span>
<span>  component <span class="op">=</span> <span class="st">"mitochondrial"</span>,</span>
<span>  adjacency_method <span class="op">=</span> <span class="st">"direct"</span>,</span>
<span>  sparse <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ped2cn.html">ped2cn</a></span><span class="op">(</span><span class="va">df_got</span>,</span>
<span>  isChild_method <span class="op">=</span> <span class="st">"partialparent"</span>,</span>
<span>  adjacency_method <span class="op">=</span> <span class="st">"indexed"</span>,</span>
<span>  sparse <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="convert-to-pairwise-format">Convert to Pairwise Format<a class="anchor" aria-label="anchor" href="#convert-to-pairwise-format"></a>
</h2>
<p>For interpretability, we convert these square matrices into
long-format tables using <code><a href="../reference/com2links.html">com2links()</a></code>. This function returns
a dataframe where each row represents a unique pair of individuals,
including their additive and common nuclear coefficients.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_links</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/com2links.html">com2links</a></span><span class="op">(</span></span>
<span>  writetodisk <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ad_ped_matrix <span class="op">=</span> <span class="va">add</span>, cn_ped_matrix <span class="op">=</span> <span class="va">cn</span>, mit_ped_matrix <span class="op">=</span> <span class="va">mt</span>,</span>
<span>  drop_upper_triangular <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="co"># %&gt;%</span></span>
<span><span class="co">#  filter(ID1 != ID2)</span></span></code></pre></div>
<p>The function can return the entire matrix or just the lower
triangular part, which is often sufficient for our purposes. Setting
<code>drop_upper_triangular = TRUE</code> ensures we only retain one
entry per dyad, since the matrices are symmetric. We also keep the data
in memory by setting <code>writetodisk = FALSE</code>.</p>
</div>
<div class="section level2">
<h2 id="locate-jon-and-daenerys">Locate Jon and Daenerys<a class="anchor" aria-label="anchor" href="#locate-jon-and-daenerys"></a>
</h2>
<p>We next identify the rows in the pairwise relatedness table that
correspond to Jon Snow and Daenerys Targaryen. First, we retrieve their
individual IDs:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find the IDs of Jon Snow and Daenerys Targaryen</span></span>
<span></span>
<span><span class="va">jon_id</span> <span class="op">&lt;-</span> <span class="va">df_got</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Jon Snow"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dany_id</span> <span class="op">&lt;-</span> <span class="va">df_got</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Daenerys Targaryen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span></span></code></pre></div>
<p>We can then filter the pairwise relatedness table to isolate the dyad
of interest:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jon_dany_row</span> <span class="op">&lt;-</span> <span class="va">df_links</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID1</span> <span class="op">==</span> <span class="va">jon_id</span> <span class="op">|</span> <span class="va">ID2</span> <span class="op">==</span> <span class="va">jon_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">dany_id</span> <span class="op">|</span> <span class="va">ID2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">dany_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># round to nearest 4th decimal</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">addRel</span>, <span class="va">mitRel</span>, <span class="va">cnuRel</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jon_dany_row</span></span></code></pre></div>
<pre><code><span><span class="co">##   ID1 ID2 addRel mitRel cnuRel</span></span>
<span><span class="co">## 1 206 211 0.5031      0      0</span></span>
<span><span class="co">## 2 211 304 0.0562      0      0</span></span></code></pre>
<p>This table contains the additive nuclear relatedness estimates for
Jon and Daenerys. If the pedigree reflects their canonical aunt-nephew
relationship and is free from… complications, we’d expect to see an
additive coefficient close to 0.25. However, the value is 0.5031,
indicating a more complex relationship and in line with how related we
would expect full siblings to be.</p>
<p>Likewise, when we examine the relatedness for a different pair, such
as Rhaenyra Targaryen and Damemon Targaryen, we can see how the
relatedness coefficients vary across different characters in the
dataset.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rhaenyra_id</span> <span class="op">&lt;-</span> <span class="va">df_got</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Rhaenyra Targaryen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span></span>
<span><span class="va">daemon_id</span> <span class="op">&lt;-</span> <span class="va">df_got</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Daemon Targaryen"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rhaenyra_daemon_row</span> <span class="op">&lt;-</span> <span class="va">df_links</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID1</span> <span class="op">==</span> <span class="va">rhaenyra_id</span> <span class="op">|</span> <span class="va">ID2</span> <span class="op">==</span> <span class="va">rhaenyra_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ID1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">daemon_id</span> <span class="op">|</span> <span class="va">ID2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">daemon_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># round to 4th decimal</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">addRel</span>, <span class="va">mitRel</span>, <span class="va">cnuRel</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rhaenyra_daemon_row</span></span></code></pre></div>
<pre><code><span><span class="co">##   ID1 ID2 addRel mitRel cnuRel</span></span>
<span><span class="co">## 1 339 536 0.7355      1      0</span></span></code></pre>
<p>Similarly, we can see that Rhaenyra and Daemon have an additive
relatedness coefficient of 0.7355, which is also slightly higher than
the expected 0.25 for a full uncle-neice relationship. In terms of
mitochondrial relatedness, both pairs have a coefficient of 1,
indicating that they share the same mitochondrial lineage.</p>
</div>
<div class="section level2">
<h2 id="plotting-the-pedigree-with-incomplete-parental-information">Plotting the Pedigree with Incomplete Parental Information<a class="anchor" aria-label="anchor" href="#plotting-the-pedigree-with-incomplete-parental-information"></a>
</h2>
<p>Many real-world and fictional pedigrees contain individuals with
unknown or partially known parentage. In such cases, plotting tools
typically fail unless these gaps are handled. We use
<code><a href="../reference/checkParentIDs.html">checkParentIDs()</a></code> to:</p>
<ul>
<li><p>Identify individuals with one known parent and one
missing</p></li>
<li><p>Create “phantom” placeholders for the missing parent</p></li>
<li><p>Optionally repair and harmonize parent fields</p></li>
</ul>
<p>To facilitate plotting, we check for individuals with one known
parent but a missing other. For those cases, we assign a placeholder ID
to the missing parent.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_repaired</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkParentIDs.html">checkParentIDs</a></span><span class="op">(</span><span class="va">df_got</span>, <span class="co"># %&gt;% filter(famID == 1),</span></span>
<span>  addphantoms <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  repair <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  parentswithoutrow <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  repairsex <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  <span class="co"># famID = 1,</span></span>
<span>  affected <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">jon_id</span>, <span class="va">dany_id</span>, <span class="fl">339</span><span class="op">)</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## REPAIR IN EARLY ALPHA</span></span></code></pre>
<p>This code creates new IDs for individuals with one known parent and a
missing other. It checks if either <code>momID</code> or
<code>dadID</code> is missing, and if so, it assigns a new ID based on
the row number. This allows us to visualize the pedigree even when some
parental information is incomplete. Now we can check the repaired
pedigree for unique IDs and parent-child relationships.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">checkIDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkIDs.html">checkIDs</a></span><span class="op">(</span><span class="va">df_repaired</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Standardizing column names...</span></span></code></pre>
<pre><code><span><span class="co">## Checking IDs...</span></span>
<span><span class="co">## Step 1: Checking for unique IDs...</span></span>
<span><span class="co">## All IDs are unique.</span></span>
<span><span class="co">## Step 2: Checking for within row duplicats...</span></span>
<span><span class="co">## No within row duplicates found.</span></span>
<span><span class="co">## Validation Results:</span></span></code></pre>
<pre><code><span><span class="co">## TRUE0NULL0000FALSENULLNULLNULL</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># checkIDs</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for unique IDs and parent-child relationships</span></span>
<span><span class="va">checkPedigreeNetwork</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkPedigreeNetwork.html">checkPedigreeNetwork</a></span><span class="op">(</span><span class="va">df_repaired</span>,</span>
<span>  personID <span class="op">=</span> <span class="st">"ID"</span>,</span>
<span>  momID <span class="op">=</span> <span class="st">"momID"</span>,</span>
<span>  dadID <span class="op">=</span> <span class="st">"dadID"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## No individuals with more than two parents detected.</span></span></code></pre>
<pre><code><span><span class="co">## No duplicate edges detected.</span></span></code></pre>
<pre><code><span><span class="co">## No cyclic relationships detected.</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">checkPedigreeNetwork</span></span></code></pre></div>
<pre><code><span><span class="co">## $individuals_with_excess_parents</span></span>
<span><span class="co">## character(0)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $duplicate_edges</span></span>
<span><span class="co">##      [,1] [,2]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $is_acyclic</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre>
<p>As we can see, the repaired pedigree now has unique IDs for all
individuals, and the parent-child relationships are intact. The function
<code><a href="../reference/checkIDs.html">checkIDs()</a></code> confirms that all IDs are unique, while
<code><a href="../reference/checkPedigreeNetwork.html">checkPedigreeNetwork()</a></code> verifies that there are no
structural issues like individuals with more than two parents or cyclic
relationships.</p>
</div>
<div class="section level2">
<h2 id="visualize-the-pedigree">Visualize the Pedigree<a class="anchor" aria-label="anchor" href="#visualize-the-pedigree"></a>
</h2>
<p>We can now visualize the repaired pedigree using the
<code><a href="https://r-computing-lab.github.io/ggpedigree/reference/ggPedigree.html" class="external-link">ggPedigree()</a></code> function from {ggpedigree}. This function
generates a plot of the pedigree, with individuals colored based on
their affected status. In this case, we highlight Jon and Daenerys as
“affected” individuals. Otherwise they would be difficult to distinguish
from the rest of the pedigree. To make the plot more informative, we
also fill every member of the tree by how related they are to Rhaenyra
Targaryen, who is the focal individual in this case.</p>
<p>This function provides a more flexible and customizable way to
visualize pedigrees, allowing for easy integration with other
<code>ggplot2</code> functions relative to kinship2’s pedigree plotting
functions.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/R-Computing-Lab/ggpedigree/" class="external-link">ggpedigree</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_repaired_renamed</span> <span class="op">&lt;-</span> <span class="va">df_repaired</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>  personID <span class="op">=</span> <span class="va">ID</span></span>
<span><span class="op">)</span></span>
<span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-computing-lab.github.io/ggpedigree/reference/ggPedigree.html" class="external-link">ggpedigree</a></span><span class="op">(</span><span class="va">df_repaired_renamed</span>,</span>
<span>  overlay_column <span class="op">=</span> <span class="st">"affected"</span>,</span>
<span>  personID <span class="op">=</span> <span class="st">"personID"</span>,</span>
<span>  interactive <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    overlay_include <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    point_size <span class="op">=</span> <span class="fl">.75</span>,</span>
<span>    code_male <span class="op">=</span> <span class="st">"M"</span>,</span>
<span>    ped_width <span class="op">=</span> <span class="fl">17</span>,</span>
<span>    label_nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">.25</span>,</span>
<span>    include_labels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    label_method <span class="op">=</span> <span class="st">"geom_text"</span>,</span>
<span>    <span class="co"># segment_self_color = "purple",</span></span>
<span>    sex_color_include <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    focal_fill_personID <span class="op">=</span> <span class="fl">353</span>, <span class="co"># 339, # 353,</span></span>
<span>    focal_fill_include <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    tooltip_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"personID"</span>, <span class="st">"name"</span>, <span class="st">"focal_fill"</span><span class="op">)</span>,</span>
<span>    focal_fill_force_zero <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    focal_fill_mid_color <span class="op">=</span> <span class="st">"orange"</span>,</span>
<span>    focal_fill_low_color <span class="op">=</span> <span class="st">"#9F2A63FF"</span>,</span>
<span>    focal_fill_legend_title <span class="op">=</span> <span class="st">"Relatedness to \nAegon Targaryen"</span>,</span>
<span>    focal_fill_na_value <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    value_rounding_digits <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">plt</span></span></code></pre></div>
<p><img src="v5_ASOIAF_files/figure-html/unnamed-chunk-13-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reduce file size for CRAN</span></span>
<span><span class="co"># if (interactive()) {</span></span>
<span><span class="co"># If running interactively, use plotly::partial_bundle</span></span>
<span><span class="co"># to reduce file size for CRAN</span></span>
<span><span class="co">#  plotly::partial_bundle(plt)</span></span>
<span><span class="co"># } else {</span></span>
<span><span class="co">#  plotly::partial_bundle(plt, local = TRUE)</span></span>
<span><span class="co"># }</span></span></code></pre></div>
<p>This plot can provide an interactive visualization of the ASOIAF
pedigree (if interactive is set to TRUE), allowing users to explore
relationships and affected status. The focal individual is highlighted,
and tooltips provide additional information about each character.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this vignette, we demonstrated how to reconstruct and analyze the
<em>A Song of Ice and Fire</em> pedigree using the <code>BGmisc</code>
package. We computed additive and common nuclear relatedness
coefficients for key characters, revealing the complexities of their
relationships. By handling incomplete parentage data and visualizing the
pedigree, we provided a comprehensive overview of how related Jon Snow
and Daenerys Targaryen truly are.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by S. Mason Garrison, Michael D. Hunter, Xuanyu Lyu, Jonathan D. Trattner, S. Alexandra Burt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
