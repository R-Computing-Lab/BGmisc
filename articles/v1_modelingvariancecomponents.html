<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Modeling variance components • BGmisc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Modeling variance components">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BGmisc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/v0_network.html">Network tools for finding extended pedigrees and path tracing</a></li>
    <li><a class="dropdown-item" href="../articles/v1_modelingvariancecomponents.html">Modeling variance components</a></li>
    <li><a class="dropdown-item" href="../articles/v2_pedigree.html">Pedigree Simulation and Visualization with BGmisc</a></li>
    <li><a class="dropdown-item" href="../articles/v3_analyticrelatedness.html">Understanding and Computing Relatedness from Pedigree Data</a></li>
    <li><a class="dropdown-item" href="../articles/v4_validation.html">Validating and Repairing Pedigree Data with BGmisc</a></li>
    <li><a class="dropdown-item" href="../articles/v5_ASOIAF.html">ASOIAF: How related are Jon and Danny?</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-Computing-Lab/BGmisc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Modeling variance components</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/R-Computing-Lab/BGmisc/blob/main/vignettes/v1_modelingvariancecomponents.Rmd" class="external-link"><code>vignettes/v1_modelingvariancecomponents.Rmd</code></a></small>
      <div class="d-none name"><code>v1_modelingvariancecomponents.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette provides a detailed guide to specific functions within
the <code>BGmisc</code> package that aid in the identification and
fitting of variance component models common in behavior genetics. We
will explore key functions such as <code>identifyComponentModel</code>,
providing practical examples and theoretical background. Identification
ensures a unique set of parameters that define the model-implied
covariance matrix, preventing free parameters from trading off one
another.</p>
<div class="section level3">
<h3 id="loading-required-libraries">Loading Required Libraries<a class="anchor" aria-label="anchor" href="#loading-required-libraries"></a>
</h3>
<p>Ensure that the <code>BGmisc</code> package is installed and
loaded.</p>
<p>Ensure that the following dependencies are installed before
proceeding as they provide us with behavior genetic data and models:</p>
<ul>
<li><p><code>EasyMx</code></p></li>
<li><p><code>OpenMx</code></p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/R-Computing-Lab/BGmisc/" class="external-link">BGmisc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bitbucket.org/mhunter/easymx" class="external-link">EasyMx</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openmx.ssri.psu.edu/" class="external-link">OpenMx</a></span><span class="op">)</span></span></code></pre></div>
<p>Note: If any of the libraries are not installed, you can install them
using install.packages(“<code>package_name</code>”).</p>
</div>
</div>
<div class="section level2">
<h2 id="working-with-variance-component-models">Working with Variance Component Models<a class="anchor" aria-label="anchor" href="#working-with-variance-component-models"></a>
</h2>
<p>In this section, we will demonstrate core functions related to the
identification and fitting of variance component models.</p>
<div class="section level3">
<h3 id="using-comp2vech-function">Using <code>comp2vech</code> Function<a class="anchor" aria-label="anchor" href="#using-comp2vech-function"></a>
</h3>
<p>The <code>comp2vech</code> function is used to vectorize a components
model. The function is often used in conjunction with the identification
process. In this example, we apply it to a list of matrices:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/comp2vech.html">comp2vech</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.5</span>, <span class="fl">.5</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.0 0.5 1.0 1.0 1.0 1.0</span></span></code></pre></div>
<p>The result showcases how the matrices have been transformed,
reflecting their role in subsequent variance component analysis.</p>
</div>
<div class="section level3">
<h3 id="using-identifycomponentmodel-function">Using <code>identifyComponentModel</code> Function<a class="anchor" aria-label="anchor" href="#using-identifycomponentmodel-function"></a>
</h3>
<p>The <code>identifyComponentModel</code> function helps determine if a
variance components model is identified. It accepts relatedness
component matrices and returns information about identified and
non-identified parameters.</p>
<p>Here’s an example using the classical twin model <em>with only MZ
twins</em>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/identifyComponentModel.html">identifyComponentModel</a></span><span class="op">(</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  E <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Component model is not identified.</span></span>
<span><span class="co">#&gt; Non-identified parameters are  A, C</span></span>
<span><span class="co">#&gt; $identified</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nidp</span></span>
<span><span class="co">#&gt; [1] "A" "C"</span></span></code></pre></div>
<p>As you can see, the model is not identified. We need to add an
additional group so that we have sufficient information. Let us add the
rest of the classical twin model, in this case DZ twins.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/identifyComponentModel.html">identifyComponentModel</a></span><span class="op">(</span></span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.5</span>, <span class="fl">.5</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  E <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Component model is identified.</span></span>
<span><span class="co">#&gt; $identified</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nidp</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
<p>As you can see the model is identified, now that we’ve added another
group. Let us confirm by fitting a model. First we prepare the data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: dplyr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="co"># require(purrr)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">twinData</span>, package <span class="op">=</span> <span class="st">"OpenMx"</span><span class="op">)</span></span>
<span><span class="va">selVars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ht1"</span>, <span class="st">"ht2"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mzdzData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span></span>
<span>  <span class="va">twinData</span>, <span class="va">zyg</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">selVars</span>, <span class="st">"zyg"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mzdzData</span><span class="op">$</span><span class="va">RCoef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">.5</span><span class="op">)</span><span class="op">[</span><span class="va">mzdzData</span><span class="op">$</span><span class="va">zyg</span><span class="op">]</span></span>
<span></span>
<span></span>
<span><span class="va">mzData</span> <span class="op">&lt;-</span> <span class="va">mzdzData</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">zyg</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Let us fit the data with MZ twins by themselves.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EasyMx/man/emxTwinModel.html" class="external-link">emxTwinModel</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">"Cholesky"</span>,</span>
<span>  relatedness <span class="op">=</span> <span class="st">"RCoef"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mzData</span>,</span>
<span>  use <span class="op">=</span> <span class="va">selVars</span>,</span>
<span>  run <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"TwCh"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running TwCh with 4 parameters</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">run1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Summary of TwCh </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; free parameters:</span></span>
<span><span class="co">#&gt;      name matrix row col   Estimate    Std.Error A lbound ubound</span></span>
<span><span class="co">#&gt; 1 sqrtA11  sqrtA   1   1 0.05122646           NA    1e-06       </span></span>
<span><span class="co">#&gt; 2 sqrtC11  sqrtC   1   1 0.03518629           NA       0!       </span></span>
<span><span class="co">#&gt; 3 sqrtE11  sqrtE   1   1 0.02325722 0.0007017955 !     0!       </span></span>
<span><span class="co">#&gt; 4    Mht1  Means ht1   1 1.62974908 0.0027023907                </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Statistics: </span></span>
<span><span class="co">#&gt;                |  Parameters  |  Degrees of Freedom  |  Fit (-2lnL units)</span></span>
<span><span class="co">#&gt;        Model:              4                   1112             -3693.148</span></span>
<span><span class="co">#&gt;    Saturated:              5                   1111                    NA</span></span>
<span><span class="co">#&gt; Independence:              4                   1112                    NA</span></span>
<span><span class="co">#&gt; Number of observations/statistics: 569/1116</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Information Criteria: </span></span>
<span><span class="co">#&gt;       |  df Penalty  |  Parameters Penalty  |  Sample-Size Adjusted</span></span>
<span><span class="co">#&gt; AIC:      -5917.148              -3685.148                -3685.078</span></span>
<span><span class="co">#&gt; BIC:     -10747.543              -3667.773                -3680.471</span></span>
<span><span class="co">#&gt; To get additional fit indices, see help(mxRefModels)</span></span>
<span><span class="co">#&gt; timestamp: 2025-09-03 14:23:03 </span></span>
<span><span class="co">#&gt; Wall clock time: 0.06642485 secs </span></span>
<span><span class="co">#&gt; optimizer:  SLSQP </span></span>
<span><span class="co">#&gt; OpenMx version number: 2.22.9 </span></span>
<span><span class="co">#&gt; Need help?  See help(mxSummary)</span></span></code></pre></div>
<p>As you can see the model was unsuccessful because it was not
identified. But when we add another group, so that the model is
identified, the model now fits.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EasyMx/man/emxTwinModel.html" class="external-link">emxTwinModel</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="st">"Cholesky"</span>,</span>
<span>  relatedness <span class="op">=</span> <span class="st">"RCoef"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mzdzData</span>,</span>
<span>  use <span class="op">=</span> <span class="va">selVars</span>,</span>
<span>  run <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"TwCh"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running TwCh with 4 parameters</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">run2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Summary of TwCh </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; free parameters:</span></span>
<span><span class="co">#&gt;      name matrix row col   Estimate    Std.Error A lbound ubound</span></span>
<span><span class="co">#&gt; 1 sqrtA11  sqrtA   1   1 0.06339271 0.0014377690    1e-06       </span></span>
<span><span class="co">#&gt; 2 sqrtC11  sqrtC   1   1 0.00000100 0.0250260004 !     0!       </span></span>
<span><span class="co">#&gt; 3 sqrtE11  sqrtE   1   1 0.02330040 0.0007015267       0!       </span></span>
<span><span class="co">#&gt; 4    Mht1  Means ht1   1 1.63295540 0.0020511844                </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Statistics: </span></span>
<span><span class="co">#&gt;                |  Parameters  |  Degrees of Freedom  |  Fit (-2lnL units)</span></span>
<span><span class="co">#&gt;        Model:              4                   1803             -5507.092</span></span>
<span><span class="co">#&gt;    Saturated:              5                   1802                    NA</span></span>
<span><span class="co">#&gt; Independence:              4                   1803                    NA</span></span>
<span><span class="co">#&gt; Number of observations/statistics: 920/1807</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Information Criteria: </span></span>
<span><span class="co">#&gt;       |  df Penalty  |  Parameters Penalty  |  Sample-Size Adjusted</span></span>
<span><span class="co">#&gt; AIC:      -9113.092              -5499.092                -5499.048</span></span>
<span><span class="co">#&gt; BIC:     -17811.437              -5479.794                -5492.498</span></span>
<span><span class="co">#&gt; To get additional fit indices, see help(mxRefModels)</span></span>
<span><span class="co">#&gt; timestamp: 2025-09-03 14:23:03 </span></span>
<span><span class="co">#&gt; Wall clock time: 0.2167299 secs </span></span>
<span><span class="co">#&gt; optimizer:  SLSQP </span></span>
<span><span class="co">#&gt; OpenMx version number: 2.22.9 </span></span>
<span><span class="co">#&gt; Need help?  See help(mxSummary)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by S. Mason Garrison, Michael D. Hunter, Xuanyu Lyu, Jonathan D. Trattner, S. Alexandra Burt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
