# Copilot Instructions for BGmisc

## Project Overview

BGmisc is an R package for extended behavior genetics analysis. It
provides functions for: - Variance component model identification -
Calculation of relatedness coefficients using path-tracing methods -
Inference of relatedness - Pedigree conversion and manipulation -
Simulation of multi-generational family data

This package is published on CRAN and follows strict R package
development standards.

## Repository Structure

- **R/**: Contains all R source code for package functions
- **tests/testthat/**: Contains unit tests using the testthat framework
- **man/**: Documentation files generated by roxygen2
- **vignettes/**: Package vignettes and articles
- **data/**: Package datasets
- **data-raw/**: Scripts for generating package data
- **.github/workflows/**: CI/CD workflows for R CMD check, test
  coverage, and pkgdown

## Development Standards

### Code Style

- Follow the [Tidyverse Style Guide](https://style.tidyverse.org/)
- Use meaningful variable and function names
- Keep functions focused and modular
- Avoid unnecessary dependencies

### Documentation

- All functions must have roxygen2 documentation with:
  - Title and description
  - `@param` for all parameters
  - `@return` for return values
  - `@examples` with working examples
  - `@export` for user-facing functions
- Update README.Rmd (not README.md directly) for user-facing
  documentation
- Include references to relevant papers and methods where applicable

### Testing

- Use the testthat package (edition 3) for all tests
- Place test files in `tests/testthat/` with prefix `test-`
- Test file names should match the source file: `test-functionName.R`
  for `functionName.R`
- Aim for high test coverage of new code
- Include tests for:
  - Expected behavior with valid inputs
  - Error handling with invalid inputs
  - Edge cases and boundary conditions
  - Regression tests for bugs

### Dependencies

- Minimize new dependencies
- Use only CRAN packages for dependencies
- Imports: data.table, igraph, Matrix, stats, stringr, methods
- Suggests packages are for testing, vignettes, or optional features

### Building and Testing

- Use `devtools::check()` or `R CMD check` before submitting changes
- Run `devtools::test()` to run all tests
- Ensure no warnings or errors in R CMD check
- Test coverage is tracked via Codecov

## Branching Strategy

This project follows a GitFlow branching strategy: - **main**: Stable,
mirrors CRAN version - **dev_main**: Pre-release integration branch,
stable - **dev**: Active development, less stable - **feature
branches**: Created from dev_main for new features

When contributing: 1. Create feature branches from dev_main 2. Make
focused, atomic commits 3. Ensure all tests pass 4. Submit PR to
dev_main branch

## Common Tasks

### Adding a New Function

1.  Create the function in the appropriate R file in `R/`
2.  Add roxygen2 documentation
3.  Add corresponding tests in `tests/testthat/`
4.  Run `devtools::document()` to update documentation
5.  Run `devtools::check()` to verify the package builds
6.  Update NEWS.md with the change

### Modifying Existing Functions

1.  Make minimal changes to achieve the goal
2.  Update roxygen2 documentation if the interface changes
3.  Add or update tests to cover the changes
4.  Ensure all existing tests still pass
5.  Update NEWS.md with the change

### Working with Pedigrees

- Pedigree data structures typically include: ID, dadID, momID, sex
- Use data.table for efficient pedigree operations
- Validate pedigree structures using checkPedigree functions
- Consider both nuclear families and extended pedigrees

### Performance Considerations

- BGmisc handles large pedigrees, so performance matters
- Use vectorized operations when possible
- Consider memory efficiency for large datasets
- Profile code if adding potentially slow operations

## Package-Specific Guidelines

### Relatedness Calculations

- Use path-tracing methods as described in Wright (1922) and McArdle &
  McDonald (1984)
- Ensure consistency with kinship2 package where applicable
- Handle inbreeding loops correctly

### Pedigree Operations

- Maintain data integrity when modifying pedigrees
- Preserve relationships and structure
- Validate inputs and outputs
- Handle edge cases (founder individuals, complex families)

### Simulation Functions

- Ensure reproducibility with set.seed()
- Document simulation parameters clearly
- Validate generated pedigrees

## References

Key papers to understand when working on this package: - Hunter et
al. (2021) - Variance component model identification - Wright (1922) -
Path coefficients and correlation - McArdle & McDonald (1984) - Path
analysis - Garrison et al. (2024) - BGmisc package paper (JOSS)

## Getting Help

- Check existing issues:
  <https://github.com/R-Computing-Lab/BGmisc/issues>
- Review the CONTRIBUTING.md file
- See package documentation: <https://r-computing-lab.github.io/BGmisc/>
- Contact maintainer: <garrissm@wfu.edu>

## Quality Standards

Before submitting code: - \[ \] All tests pass - \[ \] R CMD check
produces no errors, warnings, or notes - \[ \] Code follows Tidyverse
style guide - \[ \] Documentation is complete and accurate - \[ \]
NEWS.md is updated - \[ \] Changes are minimal and focused on the issue
